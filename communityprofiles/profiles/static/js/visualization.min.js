var vis={};vis.Visualization=function(){this.data_obj=null;this.data=[];this.geo=null;this.color=null;this.probed=null};vis.Visualization.prototype.load=function(a,b){this.data_obj=a;this.data=this.data_obj.sorted();if(b===undefined){this.geo=null}else{this.geo=b;this.geo.prep()}if(this.color===null){if(this.data_obj.classes.length==5){if(this.data_obj.lowestValue()<0){this.color=vis.Colors.five_breaks_neg(this.data_obj.classes)}else{this.color=vis.Colors.five_breaks_pos(this.data_obj.classes)}}else{if(this.data_obj.classes.length==6){this.color=vis.Colors.six_breaks(this.data_obj.classes)}else{this.color=vis.Colors.red_mono_continuous}}}};vis.Visualization.prototype.probe=function(a){this.probed=a;this.geo.probe(a)};vis.Data=function(a){this.data=a.data;this.classes=a.classes};vis.Data.prototype.condensedClasses=function(){var a=new Array();this.classes.forEach(function(b){if(b.min!=b.max){a.push(b)}});return a};vis.Data.prototype.dataForKey=function(a,c){var b=null;this.data.forEach(function(d){if(d.key==a&&(d.time==c||c===undefined)){b=d.value}});return b};vis.Data.prototype.keys=function(){var a=new Array();this.data.forEach(function(b){a.push(b.key)});return a};vis.Data.prototype.lowestBreak=function(a){return Math.floor(this.lowestValue()/a)*a};vis.Data.prototype.highestBreak=function(a){return Math.ceil(this.highestValue()/a)*a};vis.Data.prototype.lowestValue=function(){var a;this.data.forEach(function(b){if(a===undefined){a=b.value}else{if(b.value<a){a=b.value}}});return a};vis.Data.prototype.highestValue=function(){var a;this.data.forEach(function(b){if(a===undefined){a=b.value}else{if(b.value>a){a=b.value}}});return a};vis.Data.prototype.forKey=function(a,c){var b=null;this.data.forEach(function(d){if(d.key==a){b=c(d)}});return b};vis.Data.prototype.labelForKey=function(a){var b=null;this.data.forEach(function(c){if(c.key==a){b=c.label}});return b};vis.Data.prototype.sorted=function(){return this.data.sort(function(d,c){return d.value-c.value})};vis.Geo=function(b,a){this.geojson_obj=b;this.key_field=a;this.default_overlay_data=[{centLatLon:{lat:null,lng:null},label:null,geometry:{coordinates:[]}}];this.overlay_data=this.default_overlay_data};vis.Geo.prototype={geojson_obj:null,key_field:null};vis.Geo.prototype.points=function(a){var b=[];this.forEachPoint(a,function(c){b.push(c)});return b};vis.Geo.prototype.forEachPoint=function(a,b){if(a.geometry["type"]=="MultiPolygon"){a.geometry["coordinates"].forEach(function(d,c){d[0].forEach(function(f,g){var e=b(f);if(e!==undefined){d[0][g]=e}})})}else{a.geometry["coordinates"][0].forEach(function(d,e){var c=b(d);if(c!==undefined){a.geometry["coordinates"][0][e]=c}})}};vis.Geo.prototype.prep=function(){var a=this.key_field;var c=true;var b=this;this.geojson_obj.features.forEach(function(d){d.key=d.properties[a];d.label=d.key;var e=[];b.forEachPoint(d,function(f){f={lat:f[1],lng:f[0]};e.push(f);return f});d.centLatLon=vis.Geo.centroid(e)})};vis.Geo.prototype.probe=function(a){var b=this;b.overlay_data=b.default_overlay_data;this.features().forEach(function(d){if(d.key==a){b.overlay_data=[d]}})};vis.Geo.prototype.scale=function(a,c){var d=this;var b=[];this.geojson_obj.features.forEach(function(e){d.points(e).forEach(function(f){b.push(f)})});return pv.Geo.scale().domain(b).range(c,a)};vis.Geo.prototype.features=function(){return this.geojson_obj.features};vis.Geo.prototype.indexOfKey=function(b){var a=null;this.geojson_obj.features.forEach(function(d,c){if(d.key==b){a=c}return});return a};vis.Geo.centroid=function(l){var a=l.length;var g=0;var e=0;var d;var b=a-1;var k;var h;for(var c=0;c<a;b=c++){k=l[c];h=l[b];d=k.lng*h.lat-h.lng*k.lat;g+=(k.lng+h.lng)*d;e+=(k.lat+h.lat)*d}d=vis.Geo.area(l)*6;return{lng:g/d,lat:e/d}};vis.Geo.area=function(g){var d=0;var c=g.length;var a=c-1;var f;var e;for(var b=0;b<c;a=b++){f=g[b];e=g[a];d+=f.lng*e.lat;d-=f.lat*e.lng}d/=2;return d};vis.Colors={};vis.Colors.red_green_continuous=function(b){var a=pv.Scale.linear(0,50,100).range("red","yellow","green")(b);a.opacity=0.8;return a};vis.Colors.red_mono_continuous=function(b){var a=pv.Scale.linear(0,100).range("white","red")(b);a.opacity=0.8;return a};vis.Colors.five_breaks_pos=function(a){var c=pv.Scale.linear(0,4).range("white","green");var b=function(d){if(d===null||isNaN(d)){return"#fff"}d=d.toFixed(2);if(d>=a[0].min&&d<=a[0].max){return c(0.2)}if(d>a[1].min&&d<=a[1].max){return c(1)}if(d>a[2].min&&d<=a[2].max){return c(2)}if(d>a[3].min&&d<=a[3].max){return c(3)}if(d>a[4].min&&d<=a[4].max){return c(4)}};return b};vis.Colors.five_breaks_neg=function(a){var c=pv.Scale.linear(0,4).range("red","white");var b=function(d){if(d===null||isNaN(d)){return"#fff"}d=d.toFixed(2);if(d>=a[0].min&&d<a[0].max){return c(0)}if(d>=a[1].min&&d<a[1].max){return c(1)}if(d>=a[2].min&&d<a[2].max){return c(2)}if(d>=a[3].min&&d<a[3].max){return c(3)}if(d>=a[4].min&&d<a[4].max){return c(3.8)}};return b};vis.Colors.six_breaks=function(b){var a=pv.Scale.linear(0,3).range("white","green");var d=pv.Scale.linear(0,1).range("red","white");var c=function(e){if(e===null||isNaN(e)){return"#fff"}e=e.toFixed(2);if(e<0){if(e>=b[0].min&&e<b[0].max){return d(0)}if(e>=b[1].min&&e<b[1].max){return d(0.8)}}else{if(e>=b[2].min&&e<=b[2].max){return a(0.2)}if(e>b[3].min&&e<=b[3].max){return a(1)}if(e>b[4].min&&e<=b[4].max){return a(2)}if(e>b[5].min&&e<=b[5].max){return a(3)}}};return c};var util={scenes:new Array()};util.SVGsupported=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")};util.collectScene=function(a,b){if(util.scenes[a]===undefined){util.scenes[a]=b}};util.synthEvent=function(b,a){if(util.scenes[a]!==undefined){pv.Mark.dispatch(b,util.scenes[a],0)}};